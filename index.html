<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Tiny URLs by Hope-Consultants-International</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Tiny URLs</h1>
      <h2 class="project-tagline">A Liferay plugin which provides tiny URLs for pages and a variety of content types</h2>
      <a href="https://github.com/Hope-Consultants-International/tinyurl-portlet" class="btn">View on GitHub</a>
      <a href="https://github.com/Hope-Consultants-International/tinyurl-portlet/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Hope-Consultants-International/tinyurl-portlet/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h3>

<p>Obtain the plugin binary package from the Liferay Marketplace and deploy using the Liferay control panel Apps page in the usual way.</p>

<p>If you have pre-existing content in your portal, generate tiny URLs for them by restarting Liferay with the following entry in portal-ext.properties:</p>

<blockquote>
<p>tinyurl.verify.on.startup=true</p>
</blockquote>

<p>The operation may take some time to complete, depending on how much content you have on your portal. The portal will not come up until it has finished.</p>

<p>Now remove the line and restart Liferay again. From this point on, tiny URLs will be automatically generated when content is created or edited.</p>

<p>This portal property can also be used as part of future maintenance to clean up the tiny URL database table, deleting orphaned entries and creating missing entries.</p>

<h3>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h3>

<p>A typical user scenario goes like this:</p>

<ul>
<li>A user navigates to a page, views a web content article, messageboards message, etc.</li>
<li>On the page we display the tiny URL corresponding to what he is viewing.</li>
<li>The user sends the tiny URL to his friend.</li>
<li>The friend enters the tiny URL in his browser and sees exactly what the first user is seeing.</li>
</ul>

<p>To display the tiny URL to users, a tool included in the plugin can be used. Most commonly, you would place a special web content article on the page which has no content but uses a template containing a code snippet such as the following example in Velocity:</p>

<blockquote>
<p>#set ($tinyURLTools = $utilLocator.findUtil('tinyurl-portlet', 'org.hopeconsultants.portlet.tinyurl.util.TinyURLTools'))</p>

<p>#set ($friendly_url = $request.get('attributes').get('FRIENDLY_URL'))
#set ($theme_display = $request.get('theme-display'))</p>

<p>#set ($tiny_url = $tinyURLTools.getTinyURL($!friendly_url, $theme_display))</p>

<p>&lt;div class="tiny-url-wrapper"&gt; &lt;input readonly="true" value="$!tiny_url" /&gt; &lt;/div&gt;</p>
</blockquote>

<p>The resulting Tiny URLs have the format portal_url/t/xyzabc.</p>

<p>Similar code can be used a JSP page. Note that the TinyURLTools class expects the flattened ThemeDisplay object available in a web content template, so we have to construct one:</p>

<blockquote>
<p>Object tinyURLToolsBean = PortletBeanLocatorUtil.locate("tinyurl-portlet", "org.hopeconsultants.portlet.tinyurl.util.TinyURLTools");</p>

<p>MethodKey getTinyURLMethodKey = new MethodKey(tinyURLToolsBean.getClass(), "getTinyURL", String.class, Map.class);</p>

<p>MapflatThemeDisplay = new HashMap();</p>

<p>flatThemeDisplay.put("server-name", themeDisplay.getServerName());
flatThemeDisplay.put("plid", plid);
flatThemeDisplay.put("url-portal", themeDisplay.getURLPortal());</p>

<p>String tinyURL = (String)getTinyURLMethodKey.getMethod().invoke(tinyURLToolsBean, DLUtil.getPreviewURL(fileEntry, null, null, StringPool.BLANK, false, true), flatThemeDisplay);</p>
</blockquote>

<h3>
<a id="supported-content-types" class="anchor" href="#supported-content-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Supported content types</h3>

<ul>
<li>page</li>
<li>web content article</li>
<li>blogs entry</li>
<li>documents and media file</li>
<li>messageboard category</li>
<li>messageboard message</li>
<li>wiki page</li>
</ul>

<p>Note: not all the weird and wonderful formats of friendly URL are supported, only those which the portal provides in the FRIENDLY_URL request attribute.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Hope-Consultants-International/tinyurl-portlet">Tiny URLs</a> is maintained by <a href="https://github.com/Hope-Consultants-International">Hope-Consultants-International</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
